!function(e){"use strict";App.modules.reader={__settings:{},init:function(){var t=this;t.currentPageNum=1,t.jzContentWrap=e("#jz-contentwrap"),t.jzArticle=e("#jz-article"),t.jzTitle=e("#jz-title"),t.jzSubtitle=e("#jz-subtitle"),t.notifyParent(),t.getPageContent(),t.initExtensionRequest(),t.initActionBtn()},getPageContent:function(){parent.postMessage({name:"getpagecontent"},"*")},notifyParent:function(){parent.postMessage({name:"afterinitreader"},"*")},initExtensionRequest:function(){var e=this;chrome.extension.onRequest.addListener(function(t,n,i){if(n&&n.id===chrome.i18n.getMessage("@@extension_id"))switch(t.name){case"sendarticletoreader":e.sendarticletoreaderHandler(t.data,t.settings);break;case"superaddtoreader":e.superaddtoreaderHandler(t.data);break;case"lookupphrase-result":if("reader"!==t.data.from)return;e.lookupPhraseResultHandler(t.data)}})},sendarticletoreaderHandler:function(t,n){var i=this;if(""!==t.content){var a=e("<section>",{"class":"jz-addcontent",html:t.content});i.jzArticle.find(".jz-loading-tip").remove(),i.jzArticle.append(a).find("pre, code, xmp").addClass("prettyprint"),prettyPrint()}var o=t.title.trim();""!==o&&(i.jzTitle.html(o),document.title=o,/.*[\u4e00-\u9fa5]+.*$/.test(o)&&e(document.body).addClass("chinese-article")),""!==t.subtitle&&i.jzSubtitle.html(t.subtitle),e.jps.publish("init-selectionphrase",{container:e("#jz-contentwrap"),dictLookup:n.dictJzpage||"selection",from:"reader"}),i.__settings=n},superaddtoreaderHandler:function(t){var n=this;if(""!==t.content){n.currentPageNum++;var i=e("<section>",{"class":"jz-addcontent"}),a=e("<div>",{"class":"jz-pagecontent",html:t.content}),o=e("<h6>",{text:chrome.i18n.getMessage("Pagination",[n.currentPageNum]),"class":"jz-pagenum"});i.append(o).append(a),n.jzArticle.append(i).find("pre, code, xmp").addClass("prettyprint"),prettyPrint(i[0])}},initActionBtn:function(){var t=this;e("#jz-closebtn").click(function(){parent.postMessage({name:"removeiframe"},"*")}).attr("title",chrome.i18n.getMessage("Goback")),e("#jz-editbtn").click(function(){t.editContent()}).attr("title",chrome.i18n.getMessage("Edit")),e("#jz-printbtn").click(function(){e("#jz-sider").removeClass("hover"),window.print()}).attr("title",chrome.i18n.getMessage("Print")),e("#jz-helpbtn").click(function(){return t.showHelpTip(),!1}).attr("title",chrome.i18n.getMessage("Help")),e("#jz-sider").mouseenter(function(){e(this).addClass("hover")}).mouseleave(function(){e(this).removeClass("hover")}),e(document).keydown(function(e){27===e.which&&parent.postMessage({name:"removeiframe"},"*")})},editContent:function(){var t=this;"true"===t.jzContentWrap.attr("contenteditable")?(t.jzContentWrap.attr("contenteditable","false").blur(),e("#jz-editbtn").attr("title",chrome.i18n.getMessage("Edit"))):(t.jzContentWrap.attr("contenteditable","true").focus(),e("#jz-editbtn").attr("title",chrome.i18n.getMessage("Save")))},showHelpTip:function(){var e=this;e.showModal(chrome.i18n.getMessage("HelpModalTip"))},showModal:function(t,n){var i=this,a=e("<div>",{"class":"jz-modal-backdrop"}).appendTo(document.body),o='<div class="jz-modal jz-help-modal">   <div class="jz-modal-hd">       <button type="button" class="close">Ã—</button>       <h3></h3>   </div>   <div class="jz-modal-bd"></div></div>',r=e(o);r.find("h3").append(n||chrome.i18n.getMessage("ExtensionName")),r.find(".jz-modal-bd").append(t),r.appendTo(document.body);var s=function(){e(document.body).off("click.closemodal"),r.fadeOut(function(){r.remove(),a.remove(),i.modal=null})};e(document.body).on("click.closemodal",function(e){return 0===r.has(e.target).length?(s(),!1):!0}),r.find(".close").click(function(e){return s(),!1}),i.modal=r},lookupPhraseResultHandler:function(t){var n=this;e.jps.publish("init-dict-layer",{dictData:t.dictData,position:t.position,hover:"hover"===n.__settings.dictJzpage})}}}(jQuery);