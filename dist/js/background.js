!function(e){"use strict";window.jiZhuReaderBackground={init:function(){var e=this;e.initConnect(),e.browserAction(),e.createContextMenu()},initConnect:function(){var e=this;chrome.extension.onConnect.addListener(function(t){switch(t.name){case"createreader":e.createReader();break;case"articlefrompage":e.articlefrompageHandler(t);break;case"appendcontent":e.appendContentHandler(t);break;case"lookup-phrase":e.lookupPhraseHandler(t);break;case"getsettings":e.getSettingsHandler(t)}})},articlefrompageHandler:function(e){var t=this;e.onMessage.addListener(function(n){chrome.tabs.sendRequest(e.sender.tab.id,{name:"sendarticletoreader",data:n,settings:t.getSettings()})})},appendContentHandler:function(e){e.onMessage.addListener(function(t){chrome.tabs.sendRequest(e.sender.tab.id,{name:"superaddtoreader",data:t})})},lookupPhraseHandler:function(t){var n=this;t.onMessage.addListener(function(a){e.ajax({url:"http://dict.youdao.com/fsearch?q="+encodeURIComponent(a.phrase),success:function(r){chrome.tabs.sendRequest(t.sender.tab.id,{name:"lookupphrase-result",data:{dictData:n.getDictData(e(r)),position:a.position,from:a.from,phrase:a.phrase}})}})})},getSettingsHandler:function(e){var t=this;e.onMessage.addListener(function(n){chrome.tabs.sendRequest(e.sender.tab.id,{name:"settings",data:t.getSettings()})})},browserAction:function(){var e=this;chrome.browserAction.onClicked.addListener(function(t){e.createReader()})},createContextMenu:function(){var e=this;chrome.contextMenus.create({contexts:["all"],title:chrome.i18n.getMessage("ExtensionName"),onclick:function(t,n){e.createReader()}})},createReader:function(){chrome.tabs.executeScript(null,{code:"jiZhuReader.create()"})},getSettings:function(){var e=window.jiZhuReaderOptions;return{dictHostpage:e.dictHostpage,dictJzpage:e.dictJzpage}},getDictData:function(t){var n=[],a=t.find("custom-translation content");e.each(a,function(t,a){n.push(e(a).text())});var r=[],i=t.find("web-translation");e.each(i,function(t,n){r.push({key:e(n).find("key").text(),value:function(){var t=[];return e.each(e(n).find("trans value"),function(){t.push(e(this).text())}),t.join(", ")}()})});var o={phrase:t.find("return-phrase").text(),phoneticSymbol:t.find("phonetic-symbol").text(),translation:n,hasMore:r.length>0,moreTranslatioin:r};return o}},e(function(){jiZhuReaderBackground.init()})}(Zepto);